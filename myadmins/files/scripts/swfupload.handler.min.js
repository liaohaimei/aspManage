function $_(a){if(typeof a!="string"){return a}try{return document.getElementById(a)}catch(b){return null}}function formatBytes(a){var b=["B","KB","MB","GB","TB","PB"];var c=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(c))).toFixed(2)+" "+b[c]}function timeString(d,f){if(f!==true){f=false}var a=Math.floor(d/3600);d=d-a*3600;var c=Math.floor(d/60);var e=(d%60).toFixed(2);var b=e+(f?"秒":"");if(c>0){b=c+(f?"分":":")+b}if(a>0){b=a+(f?"小时":":")+b}return b}if(typeof(SWFUpload)==="function"){SWFUpload.handler={};SWFUpload.handler.stoped=false;SWFUpload.handler.onlyOne=false;SWFUpload.prototype.initSettings=(function(a){return function(){if(typeof(a)==="function"){a.call(this,[])}this.processer={};this.ensureDefault=function(c,b){this.settings[c]=(this.settings[c]==undefined)?b:this.settings[c]};this.ensureDefault("bind_id","moswf");this.ensureDefault("list_class","filelist");this.ensureDefault("process_bar_class","process_bar");this.ensureDefault("info_bar_class","info_bar");this.ensureDefault("destroy_handler",null);this.ensureDefault("file_queue_start_handler",null);this.ensureDefault("auto",false);delete this.ensureDefault;this.processer.totalBytes=0;this.processer.uploadTotalBytes=0;this.processer.uploadFileBytes=0;this.processer.speed={lasttime:null,lastbytes:0,value:0,start:null,end:null,time_used:0};this.processer.bind=$_(this.settings.bind_id);if(this.processer.bind==null){return}this.processer.user_file_queued_handler=this.settings.file_queued_handler;this.processer.user_file_queue_error_handler=this.settings.file_queue_error_handler;this.processer.user_upload_start_handler=this.settings.upload_start_handler;this.processer.user_upload_error_handler=this.settings.upload_error_handler;this.processer.user_upload_progress_handler=this.settings.upload_progress_handler;this.processer.file_queue_start_handler=this.settings.file_queue_start_handler;this.processer.user_upload_success_handler=this.settings.upload_success_handler;this.processer.user_upload_complete_handler=this.settings.upload_complete_handler;this.processer.debug_handler=this.settings.debug_handler;this.settings.file_queued_handler=SWFUpload.handler.fileQueuedHandler;this.settings.file_queue_error_handler=SWFUpload.handler.fileQueueErrorHandler;this.settings.upload_start_handler=SWFUpload.handler.uploadStartHandler;this.settings.upload_error_handler=SWFUpload.handler.uploadErrorHandler;this.settings.upload_progress_handler=SWFUpload.handler.uploadProgressHandler;this.settings.upload_success_handler=SWFUpload.handler.uploadSuccessHandler;this.settings.upload_complete_handler=SWFUpload.handler.uploadCompleteHandler;this.settings.file_dialog_complete_handler=SWFUpload.handler.fileDialogComplete;this.settings.debug_handler=SWFUpload.handler.debug;this.settings.file_queue_start_handler=SWFUpload.handler.fileQueueStart}})(SWFUpload.prototype.initSettings);SWFUpload.handler.debug=function(a){alert(a)};SWFUpload.prototype.startUploadFiles=function(a,b){if(typeof BeforeStartCallBack=="function"){if(BeforeStartCallBack(this)===false){return}}if(this.Status().busy){return}if(this.Status().queued>0){this.setButtonDisabled();SWFUpload.handler.stoped=false;this.processer.speed.start=new Date();this.startUpload(a);if(b===true){SWFUpload.handler.onlyOne=true}if(typeof StartSucceedCallBack=="function"){StartSucceedCallBack(a)}}else{if(typeof StartErrorCallBack=="function"){StartErrorCallBack()}}},SWFUpload.handler.fileQueuedHandler=function(c){this.processer.totalBytes+=c.size;if(this.processer.bind==null){return}if($_(c.id)==null){var f=this.processer.bind;var d=document.createElement("div");d.className=this.settings.list_class+" fl";d.id=c.id;f.appendChild(d);var e=document.createElement("div");e.id="b_"+c.id;e.className=this.settings.process_bar_class;d.appendChild(e);var a=document.createElement("div");a.className=this.settings.info_bar_class;a.id="i_"+c.id;d.appendChild(a)}var b=c.name;if(b.length>30){b=b.replace(/^(.{13})(.+?)(.{13})$/igm,"$1&sdot;&sdot;&sdot;$3")}$_("b_"+c.id).style.width=0;$_("i_"+c.id).innerHTML='<ul><li class="w_name"><span class="s_name">'+b+'</span><span class="gray">('+formatBytes(c.size)+')</span></li><li class="w_process" id="p_'+c.id+'">等待中</li><li class="w_size" id="sp_'+c.id+'">0</li><li class="w_act" id="a_'+c.id+'"><a href="javascript:void(0)" onclick="SWFUpload.instances[\''+this.movieName+"'].cancelUpload('"+c.id+"');\">取消</a></li></ul>";if(typeof this.processer.user_file_queued_handler==="function"){return this.processer.user_file_queued_handler.call(this,c)}};SWFUpload.handler.fileDialogComplete=function(){if(this.settings.auto&&this.Status().queued>0){this.startUploadFiles()}};SWFUpload.handler.fileQueueErrorHandler=function(a,d,c){var b="";switch(d){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:b="只能同时上传 "+this.settings.file_upload_limit+" 个文件，超过限制的文件被忽略";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:b="选择的文件超过了当前大小限制："+this.settings.file_size_limit+"，文件被忽略";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:b="零大小文件，文件被忽略";break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:b="文件扩展名必需为："+this.settings.file_types_description+" ("+this.settings.file_types+")，文件被忽略";break;default:b="未知错误，文件被忽略";break}if(typeof QueueErrorCallBack=="function"){QueueErrorCallBack(a,b,c)}if(typeof this.processer.user_file_queue_error_handler==="function"){return this.processer.user_file_queue_error_handler.call(this,a,d,c)}};SWFUpload.handler.uploadStartHandler=function(a){this.processer.speed.lasttime=new Date();this.processer.speed.lastbytes=0;this.processer.speed.start=new Date();if(typeof this.processer.user_upload_start_handler==="function"){return this.processer.user_upload_start_handler.call(this,a)}};SWFUpload.handler.uploadProgressHandler=function(d,h,f){this.processer.uploadTotalBytes=this.processer.uploadFileBytes+h;if(this.processer.speed.lasttime==null){this.processer.speed.lasttime=new Date();this.processer.speed.lastbytes=h}else{var g=(new Date())-this.processer.speed.lasttime;var b=h-this.processer.speed.lastbytes;if(g>0){var c=formatBytes(b).split(" ");b=(c[0]/g)*1000;this.processer.speed.value=b.toFixed(2)+c[1]+"/S"}}this.processer.speed.end=new Date();var e=0;if(this.processer.speed.end!=null&&this.processer.speed.start!=null){e=(this.processer.speed.end-this.processer.speed.start)}this.processer.speed.time_used=e;this.processer.uploadTotalBytes=this.processer.uploadFileBytes+h;var a=(h/f)*100;a=a.toFixed(2);if($_("b_"+d.id)!=null){$_("b_"+d.id).style.width=a+"%"}if($_("p_"+d.id)!=null){$_("p_"+d.id).innerHTML=a+"%"}if($_("sp_"+d.id)!=null){$_("sp_"+d.id).innerHTML=this.processer.speed.value}if(a=="100.00"&&typeof SavingCallBack=="function"){$_("p_"+d.id).innerHTML=SavingCallBack(d)}if(typeof this.processer.user_upload_progress_handler==="function"){return this.processer.user_upload_progress_handler.call(this,d,h,f)}};SWFUpload.handler.uploadSuccessHandler=function(b,a){this.processer.speed.end=new Date();var c=0;if(this.processer.speed.end!=null&&this.processer.speed.start!=null){c=(this.processer.speed.end-this.processer.speed.start)}if($_("sp_"+b.id)!=null){$_("sp_"+b.id).innerHTML=timeString(parseInt(c)/1000,true)}if(typeof SuccessCallBack=="function"){$_("p_"+b.id).innerHTML=SuccessCallBack.apply(this,[b,a])}this.processer.uploadFileBytes+=b.size;if(typeof this.processer.user_upload_success_handler==="function"){return this.processer.user_upload_success_handler.call(this,b,a)}};SWFUpload.handler.uploadErrorHandler=function(b,e,d,c,a){if(e==SWFUpload.UPLOAD_ERROR.FILE_CANCELLED){if(a!=null&&a==true){$_(b.id).parentNode.removeChild($_(b.id))}else{if($_("p_"+b.id)!=null){$_("p_"+b.id).innerHTML="已取消"}if($_("a_"+b.id)!=null){$_("a_"+b.id).innerHTML='<a href="javascript:void(0)" onclick="SWFUpload.instances[\''+this.movieName+"'].requeueUpload('"+b.id+"');SWFUpload.instances['"+this.movieName+"'].startUploadFiles('"+b.id+'\',true);">上传</a> <a href="javascript:void(0)" onclick="$_(\''+b.id+"').parentNode.removeChild($_('"+b.id+"'));\">移除</a>"}}}else{if(e==SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED){SWFUpload.handler.stoped=true}else{if(typeof FailedCallBack=="function"){$_("p_"+b.id).innerHTML=FailedCallBack.apply(this,[b,d,c])}}}if(typeof this.processer.user_upload_error_handler==="function"){return this.processer.user_upload_error_handler.call(this,b,e,d)}};SWFUpload.handler.uploadCompleteHandler=function(a){if(this.Status().queued>0&&!SWFUpload.handler.stoped&&!SWFUpload.handler.onlyOne){this.startUpload()}else{this.setButtonDisabled(false);SWFUpload.handler.onlyOne=false;if(typeof FinishedCallBack=="function"){FinishedCallBack.apply(this,[this.Status()])}}if(typeof this.processer.user_upload_complete_handler==="function"){return this.processer.user_upload_complete_handler.call(this,a)}};SWFUpload.handler.fileQueueStart=function(a){if(typeof fileQueueStartCallBack==="function"){fileQueueStartCallBack.call(this,a)}if(typeof this.processer.file_queue_start_handler==="function"){return this.processer.file_queue_start_handler.call(this,a)}}}function HandlerInit(b){var a={flash_url:"scripts/mo.swf",post_params:{},file_queue_limit:0,custom_settings:{},debug:false};for(var c in b){a[c]=b[c]}return new SWFUpload(a)};